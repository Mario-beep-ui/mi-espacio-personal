<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Espacio Personal de Mario</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Variables de colores y estilos */
        :root {
            --primary-gradient-start: #4a6bff;
            --primary-gradient-end: #3a0ca3;
            --secondary-gradient-start: #4361ee;
            --secondary-gradient-end: #7209b7;
            --welcome-gradient-start: #3498db;
            --welcome-gradient-end: #8e44ad;
            --light-gray: #f8f9fa;
            --dark-gray: #343a40;
            --white: #ffffff;
            --black: #000000;
            --success: #2ecc71;
            --error: #e74c3c;
            --warning: #f39c12;
            --info: #3498db;
            --shadow: 0 4px 12px rgba(0,0,0,0.1);
            --border-radius: 12px;
            --transition: all 0.3s ease;
        }

        /* Reset y estilos generales */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa, #e6e9ff);
            color: #333;
            padding-top: 70px;
            padding-bottom: 50px;
            min-height: 100vh;
            line-height: 1.5;
        }

        /* Cabecera responsiva - FIXED */
        .site-header {
            position: fixed;
            top: 0;
            width: 100%;
            background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
            box-shadow: var(--shadow);
            z-index: 1000;
            padding: 0 15px;
        }

        .site-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            min-height: 70px;
            padding: 10px 0;
        }

        .site-logo {
            color: white;
            font-size: 1.3rem;
            font-weight: bold;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .site-logo i {
            font-size: 1.5rem;
        }

        /* Menú hamburguesa para móviles */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 10px;
        }

        .site-nav-links {
            display: flex;
            list-style: none;
        }

        .site-nav-links li {
            margin-left: 15px;
        }

        .site-nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 15px;
            border-radius: 4px;
            transition: var(--transition);
            font-size: 1rem;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .site-nav-links a:hover, 
        .site-nav-links a.active {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        /* --- ESTILOS PARA MENÚ DESPLEGABLE "MÁS" --- */
        .more-menu-container {
            position: relative;
        }

        #more-menu-btn i {
            transition: transform 0.3s ease;
            font-size: 0.8em;
            margin-left: 5px;
        }

        #more-menu-btn.open i {
            transform: rotate(180deg);
        }

        .more-links-modal {
            display: none;
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
            border-radius: var(--border-radius);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            list-style: none;
            padding: 10px 0;
            margin: 0;
            min-width: 220px;
            z-index: 1100;
            animation: fadeInModal 0.3s ease;
        }

        .more-links-modal.active {
            display: block;
        }

        @keyframes fadeInModal {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .more-links-modal li {
            margin: 0;
        }

        .more-links-modal li a {
            display: block;
            width: 100%;
            padding: 12px 20px;
            border-radius: 0;
        }
        /* --- FIN DE ESTILOS DE MENÚ DESPLEGABLE --- */

        /* Secciones responsivas */
        .section {
            display: none;
            max-width: 1200px;
            margin: 30px auto 60px;
            padding: 0 15px;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Sección de Bienvenida */
        .welcome-container {
            text-align: center;
            padding: 60px 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            margin-top: 20px;
        }

        .gradient-text {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(90deg, var(--welcome-gradient-start), var(--welcome-gradient-end), var(--welcome-gradient-start));
            background-size: 300% 300%;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradient 8s ease infinite, pulse 2s ease infinite;
            margin-bottom: 25px;
            line-height: 1.2;
            padding: 0 10px;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .welcome-text {
            font-size: 1.3rem;
            color: #555;
            max-width: 800px;
            margin: 0 auto 40px;
            padding: 0 15px;
        }

        .welcome-buttons {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 30px;
        }

        .welcome-btn {
            background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
            color: white;
            border: none;
            border-radius: 50px;
            padding: 14px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 10px rgba(74, 107, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            min-width: 250px;
        }

        .welcome-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(74, 107, 255, 0.4);
        }

        /* Estilo genérico para cabeceras de sección */
        .espacio-header {
            background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
            border-radius: var(--border-radius);
            padding: 25px;
            color: white;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .espacio-header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .espacio-header p {
            font-size: 1.1rem;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }
        
        /* Contenido "Próximamente" */
        .proximamente-container {
            text-align: center;
            padding: 60px 15px;
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .proximamente-container h2 {
            color: var(--primary-gradient-end);
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .proximamente-container p {
            font-size: 1.1rem;
            color: #555;
        }

        /* Sección de Horarios y Finanzas - Selector de pestañas */
        .schedule-selector, .finance-category-selector {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 25px;
            gap: 15px;
        }

        .schedule-btn, .finance-category-btn {
            padding: 12px 25px;
            background-color: white;
            border: 2px solid var(--primary-gradient-start);
            border-radius: 30px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            color: var(--dark-gray);
            flex: 1;
            min-width: 200px;
            max-width: 250px;
        }

        .schedule-btn.active, 
        .schedule-btn:hover,
        .finance-category-btn.active,
        .finance-category-btn:hover {
            background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
            color: white;
            border-color: transparent;
        }

        .schedule-container, .finance-section-content {
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 30px;
            display: block;
        }

        .schedule-content {
            padding: 20px;
        }

        .day-columns {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .day-column {
            background-color: #f9f9f9;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .day-title {
            background: linear-gradient(135deg, var(--secondary-gradient-start), var(--secondary-gradient-end));
            color: white;
            padding: 12px;
            text-align: center;
            font-weight: 600;
            font-size: 1.2rem;
        }

        .day-tasks {
            padding: 15px;
        }

        .task-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            font-size: 0.95rem;
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .rest-day {
            background-color: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin-top: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .rest-day h3 {
            color: var(--primary-gradient-end);
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-gradient-start);
            font-size: 1.3rem;
        }

        .rest-day-item {
            margin-bottom: 10px;
            padding-left: 20px;
            position: relative;
            font-size: 1rem;
        }

        .rest-day-item::before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--primary-gradient-start);
            font-size: 1.5rem;
            top: -4px;
        }

        /* Sección de Préstamos Sam */
        .summary-card {
            background: linear-gradient(135deg, var(--secondary-gradient-start), var(--secondary-gradient-end));
            border-radius: var(--border-radius);
            padding: 25px;
            color: white;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        .summary-card h2 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .summary-card .total-amount {
            font-size: 2.5rem;
            font-weight: 700;
        }

        .loans-container {
            overflow-x: auto;
            margin-bottom: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            max-width: 100%;
        }

        .loans-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: var(--white);
            min-width: 600px;
        }

        .loans-table thead {
            background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
            color: white;
        }

        .loans-table th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .loans-table td {
            padding: 14px 16px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            color: var(--dark-gray);
        }

        .loans-table tbody tr:last-child td {
            border-bottom: none;
        }

        .loans-table tbody tr:hover {
            background-color: rgba(74, 107, 255, 0.03);
        }

        .loan-amount {
            font-weight: 700;
            font-size: 1.2rem;
            color: var(--dark-gray);
        }

        .loan-concept {
            color: var(--dark-gray);
            font-size: 1rem;
        }

        .loan-date {
            color: #6c757d;
            font-size: 0.9rem;
        }

        .loan-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            background: transparent;
            color: #6c757d;
            font-size: 1rem;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        .edit-btn:hover {
            background: rgba(52, 152, 219, 0.1);
            color: var(--info);
        }

        .delete-btn:hover {
            background: rgba(231, 76, 60, 0.1);
            color: var(--error);
        }

        .add-btn {
            background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
            color: white;
            border: none;
            border-radius: 50px;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 20px auto;
            transition: var(--transition);
            box-shadow: 0 4px 10px rgba(74, 107, 255, 0.3);
            width: 100%;
            max-width: 300px;
        }

        .add-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(74, 107, 255, 0.4);
        }

        .storage-info {
            text-align: center;
            color: #6c757d;
            font-size: 0.9rem;
            margin-top: 20px;
            padding: 0 15px;
        }

        /* Modal responsivo */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 15px;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: white;
            border-radius: var(--border-radius);
            width: 100%;
            max-width: 500px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            transform: translateY(20px);
            transition: transform 0.4s ease;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-header h3 {
            font-size: 1.4rem;
            color: var(--dark-gray);
        }

        .close-modal {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            background: transparent;
            border: none;
            color: #6c757d;
            font-size: 1.3rem;
        }

        .close-modal:hover {
            background: rgba(0,0,0,0.05);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-gray);
            font-size: 1rem;
        }

        .form-control {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            border-color: var(--primary-gradient-start);
            outline: none;
            box-shadow: 0 0 0 3px rgba(74, 107, 255, 0.2);
        }

        .btn-submit {
            background: linear-gradient(135deg, var(--primary-gradient-start), var(--primary-gradient-end));
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: var(--transition);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(74, 107, 255, 0.4);
        }

        /* Notificación */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            z-index: 3000;
            transform: translateX(100%);
            opacity: 0;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-width: 90%;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .notification.success {
            background: var(--success);
        }

        .notification.error {
            background: var(--error);
        }

        .notification.info {
            background: var(--info);
        }

        .notification i {
            font-size: 1.3rem;
        }

        .notification span {
            font-size: 1rem;
        }

        /* Pie de página responsivo */
        footer {
            position: fixed;
            bottom: 0;
            width: 100%;
            background-color: var(--primary-gradient-end);
            color: white;
            text-align: center;
            padding: 15px 0;
            font-size: 0.9rem;
            z-index: 100;
        }
        
        /* Modal para menú móvil */
        .mobile-menu-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85); /* Fondo más oscuro */
            z-index: 2000;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .mobile-menu-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .mobile-menu-content {
            background: #2c3e50; /* Fondo sólido oscuro */
            width: 90%;
            max-width: 400px;
            border-radius: 10px;
            padding: 25px 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        .mobile-nav-links {
            list-style: none;
            padding: 0;
        }

        .mobile-nav-links li {
            margin-bottom: 12px;
        }

        .mobile-nav-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            text-decoration: none;
            padding: 18px 15px;
            border-radius: 8px;
            font-size: 1.3rem;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.15);
            text-align: center;
        }

        .mobile-nav-links a i {
            margin-right: 12px;
            font-size: 1.2rem;
        }

        .mobile-nav-links a:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .mobile-nav-links a.active {
            background: rgba(255, 255, 255, 0.3);
            font-weight: 600;
        }

        .close-mobile-menu {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            z-index: 2100;
        }

        /* Clases para responsividad del menú */
        .mobile-only { display: none; }
        .desktop-only { display: list-item; }

        /* Estilos específicos para las nuevas secciones de finanzas */
        .finance-section {
            background-color: var(--white);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 25px;
            margin-bottom: 30px; /* Espacio entre secciones de finanzas */
        }

        .finance-controls {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .finance-controls label {
            font-weight: 500;
            color: var(--dark-gray);
        }

        .finance-controls input[type="date"] {
            flex-grow: 1;
            max-width: 180px;
        }

        /* Estilos para hacer las celdas de la tabla de deudas más anchas */
        #debts-table th,
        #debts-table td {
            min-width: 120px; /* Ancho mínimo para las celdas de fechas y cantidades */
            white-space: nowrap; /* Evita que el texto se envuelva en los encabezados */
        }

        #debts-table .amount-input {
            width: 100%; /* Asegura que el input ocupe todo el ancho de la celda */
            box-sizing: border-box; /* Incluye padding y border en el ancho total */
        }

        #debts-table .debt-checkbox {
            margin: 0 auto; /* Centrar checkbox */
            display: block;
        }

        /* Estilo para la fila de totales en la tabla de deudas */
        #debts-total-row tr {
            background-color: #e0e7ff; /* Un azul claro para destacar */
            font-weight: bold;
            color: var(--primary-gradient-end);
        }

        #debts-total-row td {
            padding: 15px 16px; /* Un poco más de padding */
            border-top: 2px solid var(--primary-gradient-start); /* Borde superior para separar */
        }

        /* Media Queries para Responsividad */
        /* Modificaciones para el header en móviles */
        @media (max-width: 1024px) {
            .desktop-nav { display: none; }
            .menu-toggle { display: block; }
            
            .site-logo i {
                display: none; /* Ocultar ícono en móviles */
            }
            
            .site-logo {
                font-size: 1.2rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                max-width: 150px;
            }
        }

        @media (max-width: 992px) {
            .gradient-text {
                font-size: 3rem;
            }
            
            .welcome-text {
                font-size: 1.2rem;
            }
        }

        @media (max-width: 768px) {
            .menu-toggle {
                display: block;
            }
            
            .site-nav-links.desktop-nav {
                display: none;
            }
            
            .gradient-text {
                font-size: 2.5rem;
            }
            
            .welcome-btn {
                min-width: 100%;
                max-width: 300px;
            }
            
            .espacio-header h1 {
                font-size: 1.8rem;
            }
            
            .schedule-btn {
                min-width: 100%;
                max-width: 300px;
            }
            
            .site-logo {
                font-size: 1.1rem;
                max-width: 130px;
            }
            
            .site-nav {
                min-height: 60px;
                padding: 8px 0;
            }

            .finance-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .finance-controls input[type="date"],
            .finance-controls .add-btn {
                max-width: 100%;
                width: 100%;
                margin-left: 0 !important;
            }
        }

        @media (max-width: 576px) {
            .gradient-text {
                font-size: 2.2rem;
            }
            
            .welcome-container {
                padding: 40px 10px;
            }
            
            .espacio-header {
                padding: 20px;
            }
            
            .espacio-header h1 {
                font-size: 1.6rem;
            }
            
            .task-item {
                font-size: 0.9rem;
            }
            
            .rest-day h3 {
                font-size: 1.2rem;
            }
            
            .rest-day-item {
                font-size: 0.9rem;
            }
            
            .summary-card {
                padding: 20px;
            }
            
            .summary-card h2 {
                font-size: 1.2rem;
            }
            
            .summary-card .total-amount {
                font-size: 2.2rem;
            }
            
            .loans-table th {
                padding: 14px;
                font-size: 1rem;
            }
            
            .loans-table td {
                padding: 12px 14px;
            }
            
            .loan-amount {
                font-size: 1.1rem;
            }
            
            .loan-concept {
                font-size: 0.95rem;
            }
            
            .loan-date {
                font-size: 0.85rem;
            }
            
            .action-btn {
                width: 34px;
                height: 34px;
                font-size: 0.95rem;
            }
            
            .add-btn {
                padding: 14px 25px;
                font-size: 1rem;
            }
            
            .modal-header {
                padding: 18px;
            }
            
            .modal-header h3 {
                font-size: 1.3rem;
            }
            
            .modal-body {
                padding: 20px;
            }
            
            .form-group label {
                font-size: 0.95rem;
            }
            
            .form-control {
                padding: 12px;
            }
            
            .btn-submit {
                padding: 14px;
            }
        }

        @media (max-width: 400px) {
            .gradient-text {
                font-size: 1.8rem;
            }
            
            .site-logo {
                font-size: 1rem;
                max-width: 110px;
            }
            
            .welcome-text {
                font-size: 1.1rem;
            }
            
            .mobile-nav-links a {
                font-size: 1.2rem;
                padding: 16px 12px;
            }
        }
    </style>
</head>
<body>
    <header class="site-header">
        <nav class="site-nav">
            <div class="site-logo">
                <i class="fas fa-user-circle"></i>
                Espacio Personal
            </div>
            <button class="menu-toggle" id="menu-toggle">
                <i class="fas fa-bars"></i>
            </button>
            <ul class="site-nav-links desktop-nav" id="nav-links">
                <li><a href="#" class="nav-link active" data-target="home"><i class="fas fa-home"></i>Inicio</a></li>
                <li><a href="#" class="nav-link" data-target="schedules"><i class="fas fa-calendar-alt"></i>Horarios</a></li>
                <li><a href="#" class="nav-link" data-target="loans"><i class="fas fa-hand-holding-usd"></i>Préstamos Sam</a></li>
                <li><a href="#" class="nav-link" data-target="projects"><i class="fas fa-folder-open"></i>Proyectos</a></li>
                <li><a href="#" class="nav-link" data-target="cxc"><i class="fas fa-file-invoice-dollar"></i>CxC</a></li>

                <li class="more-menu-container desktop-only">
                    <a href="#" id="more-menu-btn" class="nav-link">Más <i class="fas fa-chevron-down"></i></a>
                    <ul class="more-links-modal" id="more-links-modal">
                        <li><a href="#" class="nav-link" data-target="pendientes"><i class="fas fa-tasks"></i>Pendientes</a></li>
                        <li><a href="#" class="nav-link" data-target="finanzas"><i class="fas fa-chart-line"></i>Finanzas</a></li>
                        <li><a href="#" class="nav-link" data-target="por-hacer-sam"><i class="fas fa-heart"></i>Por Hacer con Sam</a></li>
                        <li><a href="#" class="nav-link" data-target="gustos-sam"><i class="fas fa-gift"></i>Gustos Sam</a></li>
                        <li><a href="#" class="nav-link" data-target="compras"><i class="fas fa-shopping-cart"></i>Compras Generales</a></li>
                        <li><a href="#" class="nav-link" data-target="fechas"><i class="fas fa-star"></i>Fechas Importantes</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>

    <!-- Modal para menú móvil -->
    <div class="mobile-menu-modal" id="mobile-menu-modal">
        <button class="close-mobile-menu" id="close-mobile-menu">
            <i class="fas fa-times"></i>
        </button>
        <div class="mobile-menu-content">
            <ul class="mobile-nav-links" id="mobile-nav-links">
                <li><a href="#" class="nav-link active" data-target="home"><i class="fas fa-home"></i>Inicio</a></li>
                <li><a href="#" class="nav-link" data-target="schedules"><i class="fas fa-calendar-alt"></i>Horarios</a></li>
                <li><a href="#" class="nav-link" data-target="loans"><i class="fas fa-hand-holding-usd"></i>Préstamos Sam</a></li>
                <li><a href="#" class="nav-link" data-target="projects"><i class="fas fa-folder-open"></i>Proyectos</a></li>
                <li><a href="#" class="nav-link" data-target="cxc"><i class="fas fa-file-invoice-dollar"></i>CxC</a></li>
                <li><a href="#" class="nav-link" data-target="pendientes"><i class="fas fa-tasks"></i>Pendientes</a></li>
                <li><a href="#" class="nav-link" data-target="finanzas"><i class="fas fa-chart-line"></i>Finanzas</a></li>
                <li><a href="#" class="nav-link" data-target="por-hacer-sam"><i class="fas fa-heart"></i>Por Hacer con Sam</a></li>
                <li><a href="#" class="nav-link" data-target="gustos-sam"><i class="fas fa-gift"></i>Gustos Sam</a></li>
                <li><a href="#" class="nav-link" data-target="compras"><i class="fas fa-shopping-cart"></i>Compras Generales</a></li>
                <li><a href="#" class="nav-link" data-target="fechas"><i class="fas fa-star"></i>Fechas Importantes</a></li>
            </ul>
        </div>
    </div>

    <section id="home" class="section active">
        <div class="welcome-container">
            <h1 class="gradient-text">Bienvenido a tu espacio personal Mario</h1>
            <p class="welcome-text">Este es tu espacio personal donde podrás organizar tus horarios, proyectos y metas. Aquí encontrarás todo lo necesario para mantener tu rutina organizada y alcanzar tus objetivos.</p>
            <div class="welcome-buttons">
                <button class="welcome-btn" data-target="schedules">
                    <i class="fas fa-calendar-alt"></i>Ver Mis Horarios
                </button>
                <button class="welcome-btn" data-target="loans">
                    <i class="fas fa-hand-holding-usd"></i>Préstamos Sam
                </button>
            </div>
        </div>
    </section>

    <section id="schedules" class="section">
        <div class="espacio-header">
            <h1><i class="fas fa-calendar-alt"></i>Mis Horarios</h1>
            <p>Organiza tu tiempo y mantén tu rutina bajo control</p>
        </div>

        <div class="schedule-selector">
            <button class="schedule-btn active" data-schedule="morning">Horario de Mañana</button>
            <button class="schedule-btn" data-schedule="afternoon">Horario de Tarde</button>
        </div>
        
        <div class="schedule-container morning-schedule">
            <div class="schedule-content">
                <div class="day-columns">
                    <div class="day-column">
                        <div class="day-title">LUNES</div>
                        <div class="day-tasks">
                            <div class="task-item">- LEVANTARME A LAS 4:40 AM</div>
                            <div class="task-item">- 10 MINUTOS PARA DESPERTAR</div>
                            <div class="task-item">- BAÑARME</div>
                            <div class="task-item">- SALIR A TRABAJAR A LAS 5:20 AM</div>
                            <div class="task-item">- SALIR DE TRABAJAR A LAS 3:00 PM</div>
                            <div class="task-item">- LLEGAR A CASA A LAS 4:30 PM</div>
                            <div class="task-item">- ESTUDIAR PROGRAMACIÓN DE 4:55 PM A 6:20 PM</div>
                            <div class="task-item">- SALIR CON SAM A LAS 6:25 PM</div>
                            <div class="task-item">- REGRESAR A CASA A LAS 11:30 PM</div>
                            <div class="task-item">- PREPARAR TODO PARA MAÑANA EN 10 MINUTOS</div>
                            <div class="task-item">- DORMIR ENTRE 11:45 Y 11:50 PM</div>
                        </div>
                    </div>
                    
                    <div class="day-column">
                        <div class="day-title">MARTES</div>
                        <div class="day-tasks">
                            <div class="task-item">- LEVANTARME A LAS 4:40 AM</div>
                            <div class="task-item">- 10 MINUTOS PARA DESPERTAR</div>
                            <div class="task-item">- BAÑARME</div>
                            <div class="task-item">- SALIR A TRABAJAR A LAS 5:20 AM</div>
                            <div class="task-item">- SALIR DE TRABAJAR A LAS 3:00 PM</div>
                            <div class="task-item">- LLEGAR A CASA A LAS 4:30 PM</div>
                            <div class="task-item">- ESTUDIAR PROGRAMACIÓN DE 5:00 PM A 8:00 PM</div>
                            <div class="task-item">- ESTUDIAR INGLÉS DE 8:00 PM A 9:15 PM</div>
                            <div class="task-item">- ESTUDIAR MATEMÁTICAS DE 9:15 PM A 10:30 PM</div>
                            <div class="task-item">- PREPARAR TODO PARA DORMIR</div>
                            <div class="task-item">- DORMIR DE 10:50 A 11:00 PM</div>
                        </div>
                    </div>
                    
                    <div class="day-column">
                        <div class="day-title">MIÉRCOLES</div>
                        <div class="day-tasks">
                            <div class="task-item">- LEVANTARME A LAS 4:40 AM</div>
                            <div class="task-item">- 10 MINUTOS PARA DESPERTAR</div>
                            <div class="task-item">- BAÑARME</div>
                            <div class="task-item">- SALIR A TRABAJAR A LAS 5:20 AM</div>
                            <div class="task-item">- SALIR DE TRABAJAR A LAS 3:00 PM</div>
                            <div class="task-item">- LLEGAR A CASA A LAS 4:30 PM</div>
                            <div class="task-item">- ESTUDIAR PROGRAMACIÓN DE 4:55 PM A 6:20 PM</div>
                            <div class="task-item">- SALIR CON SAM A LAS 6:25 PM</div>
                            <div class="task-item">- REGRESAR A CASA A LAS 11:30 PM</div>
                            <div class="task-item">- PREPARAR TODO PARA MAÑANA EN 10 MINUTOS</div>
                            <div class="task-item">- DORMIR ENTRE 11:45 Y 11:50 PM</div>
                        </div>
                    </div>
                    
                    <div class="day-column">
                        <div class="day-title">JUEVES</div>
                        <div class="day-tasks">
                            <div class="task-item">- LEVANTARME A LAS 4:40 AM</div>
                            <div class="task-item">- 10 MINUTOS PARA DESPERTAR</div>
                            <div class="task-item">- BAÑARME</div>
                            <div class="task-item">- SALIR A TRABAJAR A LAS 5:20 AM</div>
                            <div class="task-item">- SALIR DE TRABAJAR A LAS 3:00 PM</div>
                            <div class="task-item">- LLEGAR A CASA A LAS 4:30 PM</div>
                            <div class="task-item">- ESTUDIAR PROGRAMACIÓN DE 5:00 PM A 8:00 PM</div>
                            <div class="task-item">- ESTUDIAR INGLÉS DE 8:00 PM A 9:15 PM</div>
                            <div class="task-item">- ESTUDIAR MATEMÁTICAS DE 9:15 PM A 10:30 PM</div>
                            <div class="task-item">- PREPARAR TODO PARA DORMIR</div>
                            <div class="task-item">- DORMIR DE 10:50 A 11:00 PM</div>
                        </div>
                    </div>
                    
                    <div class="day-column">
                        <div class="day-title">VIERNES</div>
                        <div class="task-item">- LEVANTARME A LAS 4:40 AM</div>
                        <div class="task-item">- 10 MINUTOS PARA DESPERTAR</div>
                        <div class="task-item">- BAÑARME</div>
                        <div class="task-item">- SALIR A TRABAJAR A LAS 5:20 AM</div>
                        <div class="task-item">- SALIR DE TRABAJAR A LAS 3:00 PM</div>
                        <div class="task-item">- LLEGAR A CASA A LAS 4:30 PM</div>
                        <div class="task-item">- ESTUDIAR PROGRAMACIÓN DE 4:55 PM A 6:20 PM</div>
                        <div class="task-item">- SALIR CON SAM A LAS 6:25 PM</div>
                        <div class="task-item">- REGRESAR A CASA A LAS 11:30 PM</div>
                        <div class="task-item">- PREPARAR TODO PARA MAÑANA EN 10 MINUTOS</div>
                        <div class="task-item">- DORMIR ENTRE 11:45 Y 11:50 PM</div>
                    </div>
                </div>
                
                <div class="rest-day">
                    <h3>Días de Descanso</h3>
                    <div class="rest-day-item">- CUANDO DESCANSO DE LUNES A VIERNES LEVANTARME A LAS 6 AM</div>
                    <div class="rest-day-item">- LAVAR, RECOGER ESCRITORIO, EJERCICIO, DOBLAR ROPA, ESTUDIAR</div>
                    <div class="rest-day-item">- SALIR CON SAM A LAS 3 PM</div>
                    <div class="rest-day-item">- REGRESAR CON SAM A LAS 10:20 PM</div>
                </div>
            </div>
        </div>
        
        <div class="schedule-container afternoon-schedule" style="display: none;">
            <div class="schedule-content">
                <div class="day-columns">
                    <div class="day-column">
                        <div class="day-title">LUNES</div>
                        <div class="day-tasks">
                            <div class="task-item">- LEVANTARME A LAS 5:50 AM</div>
                            <div class="task-item">- 5 MINUTOS PARA DESPERTAR</div>
                            <div class="task-item">- 15 MINUTOS DE EJERCICIO</div>
                            <div class="task-item">- ESTUDIAR PROGRAMACIÓN DE 6:10 AM A 8:45 AM</div>
                            <div class="task-item">- ESTUDIAR INGLÉS DE 8:50 AM A 9:50 AM</div>
                            <div class="task-item">- 20 MINUTOS PARA COMER</div>
                            <div class="task-item">- ESTUDIAR MATEMÁTICAS DE 10:15 AM A 11:30 AM</div>
                            <div class="task-item">- PREPARAR TODO PARA EL TRABAJO, BAÑARME</div>
                            <div class="task-item">- SALIR A LAS 12:30 PM AL CAMIÓN</div>
                            <div class="task-item">- REGRESAR A CASA A LAS 11:00 PM</div>
                            <div class="task-item">- DORMIR A LAS 11:30 PM</div>
                        </div>
                    </div>
                    
                    <div class="day-column">
                        <div class="day-title">MARTES</div>
                        <div class="day-tasks">
                            <div class="task-item">- LEVANTARME A LAS 5:50 AM</div>
                            <div class="task-item">- 5 MINUTOS PARA DESPERTAR</div>
                            <div class="task-item">- 15 MINUTOS DE EJERCICIO</div>
                            <div class="task-item">- ESTUDIAR PROGRAMACIÓN DE 6:10 AM A 8:45 AM</div>
                            <div class="task-item">- ESTUDIAR INGLÉS DE 8:50 AM A 9:50 AM</div>
                            <div class="task-item">- 20 MINUTOS PARA COMER</div>
                            <div class="task-item">- ESTUDIAR MATEMÁTICAS DE 10:15 AM A 11:30 AM</div>
                            <div class="task-item">- PREPARAR TODO PARA EL TRABAJO, BAÑARME</div>
                            <div class="task-item">- SALIR A LAS 12:30 PM AL CAMIÓN</div>
                            <div class="task-item">- REGRESAR A CASA A LAS 11:00 PM</div>
                            <div class="task-item">- DORMIR A LAS 11:30 PM</div>
                        </div>
                    </div>
                    
                    <div class="day-column">
                        <div class="day-title">MIÉRCOLES</div>
                        <div class="day-tasks">
                            <div class="task-item">- LEVANTARME A LAS 5:50 AM</div>
                            <div class="task-item">- 5 MINUTOS PARA DESPERTAR</div>
                            <div class="task-item">- 15 MINUTOS DE EJERCICIO</div>
                            <div class="task-item">- ESTUDIAR PROGRAMACIÓN DE 6:10 AM A 8:45 AM</div>
                            <div class="task-item">- ESTUDIAR INGLÉS DE 8:50 AM A 9:50 AM</div>
                            <div class="task-item">- 20 MINUTOS PARA COMER</div>
                            <div class="task-item">- ESTUDIAR MATEMÁTICAS DE 10:15 AM A 11:30 AM</div>
                            <div class="task-item">- PREPARAR TODO PARA EL TRABAJO, BAÑARME</div>
                            <div class="task-item">- SALIR A LAS 12:30 PM AL CAMIÓN</div>
                            <div class="task-item">- REGRESAR A CASA A LAS 11:00 PM</div>
                            <div class="task-item">- DORMIR A LAS 11:30 PM</div>
                        </div>
                    </div>
                    
                    <div class="day-column">
                        <div class="day-title">JUEVES</div>
                        <div class="day-tasks">
                            <div class="task-item">- LEVANTARME A LAS 5:50 AM</div>
                            <div class="task-item">- 5 MINUTOS PARA DESPERTAR</div>
                            <div class="task-item">- 15 MINUTOS DE EJERCICIO</div>
                            <div class="task-item">- ESTUDIAR PROGRAMACIÓN DE 6:10 AM A 8:45 AM</div>
                            <div class="task-item">- ESTUDIAR INGLÉS DE 8:50 AM A 9:50 AM</div>
                            <div class="task-item">- 20 MINUTOS PARA COMER</div>
                            <div class="task-item">- ESTUDIAR MATEMÁTICAS DE 10:15 AM A 11:30 AM</div>
                            <div class="task-item">- PREPARAR TODO PARA EL TRABAJO, BAÑARME</div>
                            <div class="task-item">- SALIR A LAS 12:30 PM AL CAMIÓN</div>
                            <div class="task-item">- REGRESAR A CASA A LAS 11:00 PM</div>
                            <div class="task-item">- DORMIR A LAS 11:30 PM</div>
                        </div>
                    </div>
                    
                    <div class="day-column">
                        <div class="day-title">VIERNES</div>
                        <div class="task-item">- LEVANTARME A LAS 5:50 AM</div>
                        <div class="task-item">- 5 MINUTOS PARA DESPERTAR</div>
                        <div class="task-item">- 15 MINUTOS DE EJERCICIO</div>
                        <div class="task-item">- ESTUDIAR PROGRAMACIÓN DE 6:10 AM A 8:45 AM</div>
                        <div class="task-item">- ESTUDIAR INGLÉS DE 8:50 AM A 9:50 AM</div>
                        <div class="task-item">- 20 MINUTOS PARA COMER</div>
                        <div class="task-item">- ESTUDIAR MATEMÁTICAS DE 10:15 AM A 11:30 AM</div>
                        <div class="task-item">- PREPARAR TODO PARA EL TRABAJO, BAÑARME</div>
                        <div class="task-item">- SALIR A LAS 12:30 PM AL CAMIÓN</div>
                        <div class="task-item">- REGRESAR A CASA A LAS 11:00 PM</div>
                        <div class="task-item">- DORMIR A LAS 11:30 PM</div>
                    </div>
                </div>
                
                <div class="rest-day">
                    <h3>Días de Descanso</h3>
                    <div class="rest-day-item">- LEVANTARME A LAS 6 AM</div>
                    <div class="rest-day-item">- LAVAR Y HACER PENDIENTES</div>
                    <div class="rest-day-item">- ESTUDIAR PROGRAMACIÓN DE 8:40 AM A 10:40 PM</div>
                    <div class="rest-day-item">- COMER EN 20 MINUTOS</div>
                    <div class="rest-day-item">- PAUSA DE 30 MINUTOS</div>
                    <div class="rest-day-item">- ESTUDIAR INGLÉS DE 11:30 AM A 12:40 PM</div>
                    <div class="rest-day-item">- ESTUDIAR MATEMÁTICAS DE 12:40 PM A 1:55 PM</div>
                    <div class="rest-day-item">- BAÑARME PARA SALIR CON SAM A LAS 2:20 PM</div>
                    <div class="rest-day-item">- REGRESAR A CASA A LAS 11 PM</div>
                    <div class="rest-day-item">- DORMIR A LAS 11:30 PM</div>
                </div>
            </div>
        </div>
    </section>

    <section id="loans" class="section">
        <div class="espacio-header">
            <h1><i class="fas fa-hand-holding-usd"></i>Préstamos Sam & Pareja</h1>
            <p>Registro de préstamos entre parejas</p>
        </div>

        <div class="container">
            <div class="summary-card">
                <h2>Total prestado</h2>
                <div class="total-amount">$0.00</div>
            </div>

            <div class="loans-container">
                <table class="loans-table">
                    <thead>
                        <tr>
                            <th>Cantidad</th>
                            <th>Concepto</th>
                            <th>Fecha</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="loans-list">
                        <!-- Datos se cargarán dinámicamente -->
                    </tbody>
                </table>
            </div>

            <button class="add-btn" id="open-modal">
                <i class="fas fa-plus-circle"></i>Agregar préstamo Sam
            </button>

            <div class="storage-info">
                <i class="fas fa-database"></i> Datos guardados en tu navegador
            </div>
        </div>
    </section>

    <!-- Sección de Cuentas por Cobrar (CxC) -->
    <section id="cxc" class="section">
        <div class="espacio-header">
            <h1><i class="fas fa-file-invoice-dollar"></i>Cuentas por Cobrar</h1>
            <p>Gestión de tus cuentas por cobrar</p>
        </div>

        <div class="container">
            <div class="summary-card">
                <h2>Total por cobrar</h2>
                <div class="total-amount" id="total-cxc-display">$0.00</div>
            </div>

            <div class="loans-container">
                <table class="loans-table">
                    <thead>
                        <tr>
                            <th>Semana</th>
                            <th>Importe</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="cxc-list">
                        <!-- Datos se cargarán dinámicamente desde JS y localStorage -->
                    </tbody>
                </table>
            </div>

            <button class="add-btn" id="add-cxc-btn">
                <i class="fas fa-plus-circle"></i>Añadir CxC
            </button>

            <div class="storage-info">
                <i class="fas fa-database"></i> Datos guardados en tu navegador
            </div>
        </div>
    </section>

    <section id="projects" class="section">
        <div class="espacio-header">
            <h1><i class="fas fa-folder-open"></i>Mis Proyectos</h1>
            <p>Aquí encontrarás todos mis proyectos personales</p>
        </div>
        <div class="proximamente-container">
            <h2>Próximamente...</h2>
            <p>Esta sección está en desarrollo. ¡Vuelve pronto!</p>
        </div>
    </section>

    <section id="pendientes" class="section">
        <div class="espacio-header">
            <h1><i class="fas fa-tasks"></i>Pendientes</h1>
            <p>Lista de tareas y asuntos pendientes</p>
        </div>
        <div class="proximamente-container">
            <h2>Próximamente...</h2>
            <p>Esta sección está en desarrollo. ¡Vuelve pronto!</p>
        </div>
    </section>

    <section id="finanzas" class="section">
        <div class="espacio-header">
            <h1><i class="fas fa-chart-line"></i>Finanzas Personales</h1>
            <p>Control de tus ingresos y egresos</p>
        </div>

        <div class="finance-category-selector">
            <button class="finance-category-btn active" data-finance-category="debts">Deudas</button>
            <button class="finance-category-btn" data-finance-category="gastos">Gastos Personales</button>
            <button class="finance-category-btn" data-finance-category="pagos">Fechas de Pago</button>
        </div>

        <!-- Apartado de Deudas -->
        <div class="container finance-section-content debts-content">
            <div class="summary-card">
                <h2>Total de Deudas</h2>
                <div class="total-amount" id="total-deudas-display">$0.00</div>
            </div>

            <div class="finance-controls">
                <label for="start-date-debts">Fecha de Inicio:</label>
                <input type="date" id="start-date-debts" class="form-control" style="width: auto; display: inline-block; margin-right: 10px;">
                <label for="end-date-debts">Fecha de Fin:</label>
                <input type="date" id="end-date-debts" class="form-control" style="width: auto; display: inline-block;">
                <button class="add-btn" id="generate-debt-dates-btn" style="width: auto; margin-left: 10px; padding: 10px 20px;">Generar Fechas</button>
            </div>

            <div class="loans-container" style="overflow-x: auto;">
                <table class="loans-table" id="debts-table">
                    <thead>
                        <tr id="debt-dates-row">
                            <th>Deuda</th>
                            <!-- Fechas de viernes se añadirán aquí dinámicamente -->
                        </tr>
                    </thead>
                    <tbody id="debts-list">
                        <!-- Filas de deudas se añadirán aquí dinámicamente -->
                    </tbody>
                    <tfoot id="debts-total-row">
                        <!-- Totales por fecha se añadirán aquí dinámicamente -->
                    </tfoot>
                </table>
            </div>

            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                <button class="add-btn" id="add-debt-btn" style="width: auto; padding: 10px 20px;"><i class="fas fa-plus-circle"></i>Añadir Deuda</button>
                <button class="add-btn" id="edit-debt-mode-btn" style="width: auto; padding: 10px 20px;"><i class="fas fa-edit"></i>Editar Deudas</button>
                <button class="add-btn delete-selected-btn" id="delete-selected-debts-btn" style="width: auto; padding: 10px 20px; background: linear-gradient(135deg, var(--error), #c0392b);"><i class="fas fa-trash-alt"></i>Eliminar Seleccionadas</button>
            </div>
        </div>

        <!-- Apartado de Gastos Personales -->
        <div class="container finance-section-content gastos-content" style="display: none;">
            <div class="summary-card">
                <h2>Total de Gastos Personales</h2>
                <div class="total-amount" id="total-gastos-display">$0.00</div>
            </div>

            <div class="loans-container" style="overflow-x: auto;">
                <table class="loans-table" id="gastos-table">
                    <thead>
                        <tr>
                            <th>Gasto</th>
                            <th>Cantidad</th>
                            <th>Fecha</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="gastos-list">
                        <!-- Filas de gastos se añadirán aquí dinámicamente -->
                    </tbody>
                </table>
            </div>

            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                <button class="add-btn" id="add-gasto-btn" style="width: auto; padding: 10px 20px;"><i class="fas fa-plus-circle"></i>Añadir Gasto</button>
                <button class="add-btn" id="edit-gasto-mode-btn" style="width: auto; padding: 10px 20px;"><i class="fas fa-edit"></i>Editar Gastos</button>
                <button class="add-btn delete-selected-btn" id="delete-selected-gastos-btn" style="width: auto; padding: 10px 20px; background: linear-gradient(135deg, var(--error), #c0392b);"><i class="fas fa-trash-alt"></i>Eliminar Seleccionados</button>
            </div>
        </div>

        <!-- Apartado de Fechas de Pago -->
        <div class="container finance-section-content pagos-content" style="display: none;">
            <div class="summary-card">
                <h2>Fechas de Pago</h2>
                <p>Registro de fechas importantes para pagos</p>
            </div>

            <div class="loans-container" style="overflow-x: auto;">
                <table class="loans-table" id="fechas-pago-table">
                    <thead>
                        <tr>
                            <th>Deuda</th>
                            <th>Fecha de Pago</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="fechas-pago-list">
                        <!-- Datos de la imagen se añadirán aquí -->
                    </tbody>
                </table>
            </div>

            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                <button class="add-btn" id="add-pago-btn" style="width: auto; padding: 10px 20px;"><i class="fas fa-plus-circle"></i>Añadir Pago</button>
                <button class="add-btn" id="edit-pago-mode-btn" style="width: auto; padding: 10px 20px;"><i class="fas fa-edit"></i>Editar Pagos</button>
                <button class="add-btn delete-selected-btn" id="delete-selected-pagos-btn" style="width: auto; padding: 10px 20px; background: linear-gradient(135deg, var(--error), #c0392b);"><i class="fas fa-trash-alt"></i>Eliminar Seleccionados</button>
            </div>
        </div>
    </section>

    <section id="por-hacer-sam" class="section">
        <div class="espacio-header">
            <h1><i class="fas fa-heart"></i>Por Hacer con Sam</h1>
            <p>Planes y actividades para hacer juntos</p>
        </div>
        <div class="proximamente-container">
            <h2>Próximamente...</h2>
            <p>Esta sección está en desarrollo. ¡Vuelve pronto!</p>
        </div>
    </section>

    <section id="gustos-sam" class="section">
        <div class="espacio-header">
            <h1><i class="fas fa-gift"></i>Gustos de Sam</h1>
            <p>Recordatorios de cosas que le gustan a Sam</p>
        </div>
        <div class="proximamente-container">
            <h2>Próximamente...</h2>
            <p>Esta sección está en desarrollo. ¡Vuelve pronto!</p>
        </div>
    </section>

    <section id="compras" class="section">
        <div class="espacio-header">
            <h1><i class="fas fa-shopping-cart"></i>Compras Generales</h1>
            <p>Lista de compras y necesidades</p>
        </div>
        <div class="proximamente-container">
            <h2>Próximamente...</h2>
            <p>Esta sección está en desarrollo. ¡Vuelve pronto!</p>
        </div>
    </section>

    <section id="fechas" class="section">
        <div class="espacio-header">
            <h1><i class="fas fa-star"></i>Fechas Importantes</h1>
            <p>Aniversarios, cumpleaños y eventos especiales</p>
        </div>
        <div class="proximamente-container">
            <h2>Próximamente...</h2>
            <p>Esta sección está en desarrollo. ¡Vuelve pronto!</p>
        </div>
    </section>

    <!-- Modal para Préstamos -->
    <div class="modal" id="loan-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">Agregar nuevo préstamo</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="loan-form">
                    <input type="hidden" id="loan-id">
                    <div class="form-group">
                        <label for="loan-amount">Cantidad ($)</label>
                        <input type="number" id="loan-amount" class="form-control" step="0.01" min="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="loan-concept">Concepto</label>
                        <input type="text" id="loan-concept" class="form-control" required>
                    </div>
                    <button type="submit" class="btn-submit">Guardar préstamo</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para CxC -->
    <div class="modal" id="cxc-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="cxc-modal-title">Agregar nueva cuenta por cobrar</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="cxc-form">
                    <div class="form-group">
                        <label for="cxc-week">Semana</label>
                        <input type="text" id="cxc-week" class="form-control" placeholder="Ej: 2025133" required>
                    </div>
                    <div class="form-group">
                        <label for="cxc-amount">Importe ($)</label>
                        <input type="number" id="cxc-amount" class="form-control" step="0.01" min="0.01" placeholder="Ej: 350.75" required>
                    </div>
                    <button type="submit" class="btn-submit">Guardar CxC</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Añadir/Editar Deuda -->
    <div class="modal" id="debt-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="debt-modal-title">Añadir Nueva Deuda</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="debt-form">
                    <input type="hidden" id="debt-id">
                    <div class="form-group">
                        <label for="debt-name">Nombre de la Deuda</label>
                        <input type="text" id="debt-name" class="form-control" required>
                    </div>
                    <div id="debt-amounts-group" class="form-group">
                        <!-- Campos de cantidad para cada fecha se añadirán aquí dinámicamente -->
                    </div>
                    <button type="submit" class="btn-submit">Guardar Deuda</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Añadir/Editar Gasto Personal -->
    <div class="modal" id="gasto-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="gasto-modal-title">Añadir Nuevo Gasto</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="gasto-form">
                    <input type="hidden" id="gasto-id">
                    <div class="form-group">
                        <label for="gasto-name-select">Nombre del Gasto</label>
                        <select id="gasto-name-select" class="form-control" required>
                            <option value="">Selecciona un gasto</option>
                            <option value="CxC">CxC</option>
                            <option value="Saldo">Saldo</option>
                            <option value="Dinero Transporte">Dinero Transporte</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="gasto-amount">Cantidad ($)</label>
                        <input type="number" id="gasto-amount" class="form-control" step="0.01" min="0.01" required>
                    </div>
                    <div class="form-group">
                        <label for="gasto-date">Fecha</label>
                        <input type="date" id="gasto-date" class="form-control" required>
                    </div>
                    <button type="submit" class="btn-submit">Guardar Gasto</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal para Añadir/Editar Fecha de Pago -->
    <div class="modal" id="pago-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="pago-modal-title">Añadir Nueva Fecha de Pago</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="pago-form">
                    <input type="hidden" id="pago-id">
                    <div class="form-group">
                        <label for="pago-debt-name">Deuda</label>
                        <input type="text" id="pago-debt-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="pago-date-input">Fecha de Pago</label>
                        <input type="text" id="pago-date-input" class="form-control" placeholder="Ej: 16 de cada mes / 22-jun-25" required>
                    </div>
                    <button type="submit" class="btn-submit">Guardar Pago</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmación para Eliminar (General) -->
    <div class="modal" id="confirm-delete-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Confirmar Eliminación</h3>
                <button class="close-modal" id="close-confirm-delete-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p id="confirm-delete-message">¿Estás seguro de que deseas eliminar los elementos seleccionados?</p>
                <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button class="btn-submit" id="cancel-delete-btn" style="background: #ccc; color: #333;">Cancelar</button>
                    <button class="btn-submit" id="confirm-delete-btn" style="background: var(--error);">Eliminar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notificación -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-text">Operación realizada con éxito</span>
    </div>

    <footer>
        <p>Todos los derechos reservados a Mario Vázquez © 2025</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const menuToggle = document.getElementById('menu-toggle');
            const navLinks = document.getElementById('nav-links');
            const navItems = document.querySelectorAll('.nav-link');
            const moreMenuBtn = document.getElementById('more-menu-btn');
            const moreLinksModal = document.getElementById('more-links-modal');
            const mobileMenuModal = document.getElementById('mobile-menu-modal');
            const closeMobileMenu = document.getElementById('close-mobile-menu');
            const mobileNavLinks = document.querySelectorAll('#mobile-nav-links .nav-link');

            // --- Lógica de Navegación ---
            
            // Activar sección inicial
            activateSection('home');
            
            // Toggle del menú móvil
            menuToggle.addEventListener('click', () => {
                mobileMenuModal.classList.add('active');
            });
            
            // Cerrar menú móvil
            closeMobileMenu.addEventListener('click', () => {
                mobileMenuModal.classList.remove('active');
            });
            
            // Clic en cualquier link de navegación en el modal móvil
            mobileNavLinks.forEach(item => {
                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = this.getAttribute('data-target');
                    activateSection(target);
                    
                    // Actualizar estado activo de los links
                    updateActiveLink(this);
                    
                    // Cerrar modal móvil
                    mobileMenuModal.classList.remove('active');
                });
            });

            // Clic en cualquier link de navegación en escritorio
            navItems.forEach(item => {
                // El botón "Más" no navega, solo abre el menú
                if (item.id === 'more-menu-btn') return;

                item.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = this.getAttribute('data-target');
                    activateSection(target);
                    
                    // Actualizar estado activo de los links
                    updateActiveLink(this);
                    
                    // Cerrar menús
                    if (window.innerWidth <= 1024) {
                        navLinks.classList.remove('active');
                    }
                    if (moreLinksModal.classList.contains('active')) {
                        moreLinksModal.classList.remove('active');
                        moreMenuBtn.classList.remove('open');
                    }
                });
            });

            // Abrir/Cerrar menú "Más"
            if (moreMenuBtn) {
                moreMenuBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    moreLinksModal.classList.toggle('active');
                    this.classList.toggle('open');
                });
            }

            // Cerrar menú "Más" si se hace clic fuera
            window.addEventListener('click', function(e) {
                if (moreMenuBtn && !moreMenuBtn.parentElement.contains(e.target)) {
                    moreLinksModal.classList.remove('active');
                    moreMenuBtn.classList.remove('open');
                }
            });

            // Botones de bienvenida que también navegan
            document.querySelectorAll('.welcome-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const target = this.getAttribute('data-target');
                    activateSection(target);
                    const linkToActivate = document.querySelector(`.nav-link[data-target="${target}"]`);
                    updateActiveLink(linkToActivate);
                });
            });
            
            // --- Funciones de Ayuda para Navegación ---
            function activateSection(sectionId) {
                document.querySelectorAll('.section').forEach(section => {
                    section.classList.remove('active');
                });
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            function updateActiveLink(activeLink) {
                // Actualizar enlaces en escritorio
                navItems.forEach(i => i.classList.remove('active'));
                
                // Actualizar enlaces en móvil
                mobileNavLinks.forEach(i => i.classList.remove('active'));
                
                if (activeLink) {
                    // If the link is inside the "More" modal, activate the "More" button
                    if (activeLink.closest('.more-links-modal')) {
                        if(moreMenuBtn) moreMenuBtn.classList.add('active');
                    } else {
                        // If it's a visible link, activate itself
                        activeLink.classList.add('active');
                    }
                }
            }

            // --- Lógica de Horarios ---
            const scheduleBtns = document.querySelectorAll('.schedule-btn');
            const scheduleContainers = document.querySelectorAll('.schedule-container');
            
            scheduleBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const scheduleType = this.getAttribute('data-schedule');
                    scheduleBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    scheduleContainers.forEach(container => {
                        container.style.display = 'none';
                        if(container.classList.contains(`${scheduleType}-schedule`)) {
                            container.style.display = 'block';
                        }
                    });
                });
            });
            
            // --- Lógica para Préstamos ---
            const loanForm = document.getElementById('loan-form');
            const loansList = document.getElementById('loans-list');
            const totalAmountElement = document.querySelector('#loans .total-amount'); // Corregido selector
            const openModalButton = document.getElementById('open-modal');
            const modal = document.getElementById('loan-modal');
            const closeModalButton = modal.querySelector('.close-modal'); // Selector específico para este modal
            const modalTitle = document.getElementById('modal-title');
            const loanIdInput = document.getElementById('loan-id');
            const loanAmountInput = document.getElementById('loan-amount');
            const loanConceptInput = document.getElementById('loan-concept');
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            let loans = [];
            let currentEditId = null;
            
            function loadLoans() {
                try {
                    const savedLoans = localStorage.getItem('prestamosSam');
                    loans = savedLoans ? JSON.parse(savedLoans) : [];
                    console.log("Préstamos cargados:", loans); // Debug log
                } catch (e) {
                    console.error("Error al cargar préstamos de localStorage", e);
                    loans = [];
                }
            }
            
            function saveLoans() {
                try {
                    localStorage.setItem('prestamosSam', JSON.stringify(loans));
                    console.log("Préstamos guardados:", loans); // Debug log
                } catch (e) {
                    console.error("Error al guardar préstamos en localStorage", e);
                }
            }
            
            function calculateTotal() {
                const total = loans.reduce((sum, loan) => sum + parseFloat(loan.amount), 0);
                totalAmountElement.textContent = `$${total.toFixed(2)}`;
            }
            
            function renderLoans() {
                loansList.innerHTML = '';
                if (loans.length === 0) {
                    loansList.innerHTML = `<tr><td colspan="4" style="text-align: center; padding: 30px;">No hay préstamos registrados</td></tr>`;
                    calculateTotal();
                    return;
                }
                loans.forEach(loan => {
                    const row = document.createElement('tr');
                    const loanDate = new Date(loan.date);
                    const formattedDate = loanDate.toLocaleString('es-ES', { day: '2-digit', month: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' });
                    row.innerHTML = `
                        <td class="loan-amount">$${parseFloat(loan.amount).toFixed(2)}</td>
                        <td class="loan-concept">${loan.concept}</td>
                        <td class="loan-date">${formattedDate}</td>
                        <td class="loan-actions">
                            <button class="action-btn edit-btn" data-id="${loan.id}"><i class="fas fa-edit"></i></button>
                            <button class="action-btn delete-btn" data-id="${loan.id}"><i class="fas fa-trash-alt"></i></button>
                        </td>`;
                    loansList.appendChild(row);
                });
                calculateTotal();
                addLoanRowEventListeners(); // Re-add event listeners after rendering
            }
            
            function openLoanModal(loanId = null) {
                currentEditId = loanId;
                if (loanId) {
                    modalTitle.textContent = 'Editar préstamo';
                    const loan = loans.find(l => l.id === loanId);
                    if (loan) {
                        loanIdInput.value = loan.id;
                        loanAmountInput.value = loan.amount;
                        loanConceptInput.value = loan.concept;
                    }
                } else {
                    modalTitle.textContent = 'Agregar nuevo préstamo';
                    loanForm.reset();
                    loanIdInput.value = '';
                }
                modal.classList.add('active');
            }
            
            function closeLoanModal() {
                modal.classList.remove('active');
                currentEditId = null;
            }
            
            function handleLoanFormSubmit(e) {
                e.preventDefault();
                const amount = parseFloat(loanAmountInput.value);
                const concept = loanConceptInput.value.trim();
                if (isNaN(amount) || amount <= 0 || concept === '') {
                    showNotification('Por favor completa todos los campos correctamente', 'error');
                    return;
                }
                if (currentEditId) {
                    const loanIndex = loans.findIndex(l => l.id === currentEditId);
                    if (loanIndex !== -1) {
                        loans[loanIndex].amount = amount;
                        loans[loanIndex].concept = concept;
                        showNotification('Préstamo actualizado con éxito', 'success');
                    }
                } else {
                    const newLoan = { id: Date.now(), amount: amount, concept: concept, date: new Date().toISOString() };
                    loans.push(newLoan);
                    showNotification('Préstamo agregado con éxito', 'success');
                }
                saveLoans();
                renderLoans();
                closeLoanModal();
            }

            function addLoanRowEventListeners() {
                loansList.querySelectorAll('.edit-btn').forEach(button => {
                    button.onclick = () => openLoanModal(parseInt(button.dataset.id));
                });
                loansList.querySelectorAll('.delete-btn').forEach(button => {
                    button.onclick = () => showConfirmDeleteModal(parseInt(button.dataset.id), 'loan');
                });
            }
            
            function showNotification(message, type = 'success') {
                notificationText.textContent = message;
                notification.className = `notification ${type} show`;
                const icon = notification.querySelector('i');
                if (type === 'success') icon.className = 'fas fa-check-circle';
                if (type === 'error') icon.className = 'fas fa-times-circle';
                if (type === 'info') icon.className = 'fas fa-info-circle';
                setTimeout(() => notification.classList.remove('show'), 3000);
            }
            
            // Carga inicial y listeners de préstamos
            loadLoans();
            renderLoans();
            openModalButton.addEventListener('click', () => openLoanModal());
            closeModalButton.addEventListener('click', () => closeLoanModal());
            loanForm.addEventListener('submit', handleLoanFormSubmit);
            modal.addEventListener('click', (e) => { if (e.target === modal) closeLoanModal(); });
            
            // --- Lógica para CxC ---
            const cxcForm = document.getElementById('cxc-form');
            const cxcList = document.getElementById('cxc-list');
            const totalCxcAmountElement = document.getElementById('total-cxc-display'); // Changed to specific ID
            const addCxcButton = document.getElementById('add-cxc-btn');
            const cxcModal = document.getElementById('cxc-modal');
            const closeCxcModalButton = cxcModal.querySelector('.close-modal');
            const cxcModalTitle = document.getElementById('cxc-modal-title');
            const cxcWeekInput = document.getElementById('cxc-week');
            const cxcAmountInput = document.getElementById('cxc-amount');
            
            // Initial CxC data (from the original HTML, converted to JS array)
            const initialCxCsData = [
                { id: 1, week: "2025129", amount: 115.50 },
                { id: 2, week: "2025130", amount: 290.00 },
                { id: 3, week: "2025131", amount: 1068.50 },
                { id: 4, week: "2025132", amount: 583.97 }
            ];

            let cxcs = []; 
            
            function loadCxCs() {
                try {
                    const savedCxCs = localStorage.getItem('cuentasPorCobrar');
                    cxcs = savedCxCs ? JSON.parse(savedCxCs) : initialCxCsData; // Use initialCxCsData if nothing saved
                    console.log("CxC cargadas:", cxcs); // Debug log
                } catch (e) {
                    console.error("Error al cargar CxC de localStorage", e);
                    cxcs = initialCxCsData; // Fallback
                }
            }

            function saveCxCs() {
                try {
                    localStorage.setItem('cuentasPorCobrar', JSON.stringify(cxcs));
                    console.log("CxC guardadas:", cxcs); // Debug log
                } catch (e) {
                    console.error("Error al guardar CxC en localStorage", e);
                }
            }

            function calculateTotalCxc() {
                const total = cxcs.reduce((sum, cxc) => sum + parseFloat(cxc.amount), 0);
                totalCxcAmountElement.textContent = `$${total.toFixed(2)}`;
            }

            function renderCxCs() {
                cxcList.innerHTML = '';
                if (cxcs.length === 0) {
                    cxcList.innerHTML = `<tr><td colspan="3" style="text-align: center; padding: 30px;">No hay cuentas por cobrar registradas</td></tr>`;
                    calculateTotalCxc();
                    return;
                }
                cxcs.forEach(cxc => {
                    const row = document.createElement('tr');
                    row.dataset.id = cxc.id;
                    row.dataset.week = cxc.week;
                    row.dataset.amount = cxc.amount;
                    row.innerHTML = `
                        <td>${cxc.week}</td>
                        <td class="loan-amount">$${parseFloat(cxc.amount).toFixed(2)}</td>
                        <td class="loan-actions">
                            <button class="action-btn edit-btn"><i class="fas fa-edit"></i></button>
                            <button class="action-btn delete-btn"><i class="fas fa-trash-alt"></i></button>
                        </td>
                    `;
                    cxcList.appendChild(row);
                    addCxcRowEventListeners(row);
                });
                calculateTotalCxc();
            }
            
            // Abrir modal para añadir CxC
            addCxcButton.addEventListener('click', () => {
                cxcForm.reset();
                cxcModalTitle.textContent = 'Agregar nueva cuenta por cobrar';
                cxcModal.classList.add('active');
            });
            
            // Cerrar modal CxC
            closeCxcModalButton.addEventListener('click', () => {
                cxcModal.classList.remove('active');
            });
            
            // Enviar formulario CxC
            cxcForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const week = cxcWeekInput.value.trim();
                const amount = parseFloat(cxcAmountInput.value);
                
                if (week && !isNaN(amount) && amount > 0) {
                    const newCxc = {
                        id: Date.now(),
                        week: week,
                        amount: amount
                    };
                    
                    cxcs.push(newCxc);
                    saveCxCs();
                    renderCxCs(); // Re-render all CxCs to ensure event listeners are correctly attached
                    
                    cxcModal.classList.remove('active');
                    showNotification('Cuenta por cobrar añadida con éxito', 'success');
                } else {
                    showNotification('Por favor ingresa datos válidos', 'error');
                }
            });
            
            function addCxcRowEventListeners(row) {
                // Botón editar
                row.querySelector('.edit-btn').addEventListener('click', function() {
                    const weekCell = row.cells[0];
                    const amountCell = row.cells[1];
                    
                    // Guardar valores originales
                    const originalWeek = weekCell.textContent;
                    const originalAmount = parseFloat(amountCell.textContent.replace('$', ''));

                    // Convertir a campos editables
                    weekCell.innerHTML = `<input type="text" class="form-control" value="${originalWeek}">`;
                    amountCell.innerHTML = `<input type="number" class="form-control" value="${originalAmount}" step="0.01">`;
                    
                    // Cambiar botones
                    const actionsCell = row.cells[2];
                    actionsCell.innerHTML = `
                        <button class="action-btn save-btn"><i class="fas fa-save"></i></button>
                        <button class="action-btn cancel-btn"><i class="fas fa-times"></i></button>
                    `;
                    
                    // Event listener para guardar
                    actionsCell.querySelector('.save-btn').addEventListener('click', function() {
                        const newWeek = row.querySelector('td:first-child input').value.trim();
                        const newAmount = parseFloat(row.querySelector('td:nth-child(2) input').value);
                        
                        if (newWeek && !isNaN(newAmount) && newAmount > 0) {
                            // Actualizar datos en el array
                            const rowId = parseInt(row.dataset.id);
                            const cxcIndex = cxcs.findIndex(c => c.id === rowId);
                            if (cxcIndex !== -1) {
                                cxcs[cxcIndex].week = newWeek;
                                cxcs[cxcIndex].amount = newAmount;
                            }
                            saveCxCs();
                            renderCxCs(); // Re-render all CxCs
                            showNotification('Cuenta actualizada con éxito', 'success');
                        } else {
                            showNotification('Datos inválidos', 'error');
                        }
                    });
                    
                    // Event listener para cancelar
                    actionsCell.querySelector('.cancel-btn').addEventListener('click', function() {
                        // Restaurar valores originales
                        weekCell.textContent = originalWeek;
                        amountCell.innerHTML = `$${originalAmount.toFixed(2)}`;
                        
                        // Restaurar botones
                        actionsCell.innerHTML = `
                            <button class="action-btn edit-btn"><i class="fas fa-edit"></i></button>
                            <button class="action-btn delete-btn"><i class="fas fa-trash-alt"></i></button>
                        `;
                        
                        // Volver a agregar event listeners
                        addCxcRowEventListeners(row);
                    });
                });
                
                // Botón eliminar
                row.querySelector('.delete-btn').addEventListener('click', function() {
                    const rowId = parseInt(row.dataset.id);
                    showConfirmDeleteModal(rowId, 'cxc');
                });
            }

            // Carga inicial de CxC
            loadCxCs();
            renderCxCs();

            // --- Lógica para Finanzas (Deudas, Gastos Personales, Fechas de Pago) ---

            // Referencias a elementos del DOM para Deudas
            const startDateDebtsInput = document.getElementById('start-date-debts');
            const endDateDebtsInput = document.getElementById('end-date-debts');
            const generateDebtDatesBtn = document.getElementById('generate-debt-dates-btn');
            const debtDatesRow = document.getElementById('debt-dates-row');
            const debtsList = document.getElementById('debts-list');
            const debtsTotalRow = document.getElementById('debts-total-row');
            const totalDeudasDisplay = document.getElementById('total-deudas-display');
            const addDebtBtn = document.getElementById('add-debt-btn');
            const editDebtModeBtn = document.getElementById('edit-debt-mode-btn');
            const deleteSelectedDebtsBtn = document.getElementById('delete-selected-debts-btn');
            const debtModal = document.getElementById('debt-modal');
            const debtModalCloseBtn = debtModal.querySelector('.close-modal');
            const debtModalTitle = document.getElementById('debt-modal-title');
            const debtForm = document.getElementById('debt-form');
            const debtIdInput = document.getElementById('debt-id');
            const debtNameInput = document.getElementById('debt-name');
            const debtAmountsGroup = document.getElementById('debt-amounts-group');

            // Referencias a elementos del DOM para Gastos Personales
            const gastosList = document.getElementById('gastos-list');
            const totalGastosDisplay = document.getElementById('total-gastos-display');
            const addGastoBtn = document.getElementById('add-gasto-btn');
            const editGastoModeBtn = document.getElementById('edit-gasto-mode-btn');
            const deleteSelectedGastosBtn = document.getElementById('delete-selected-gastos-btn');
            const gastoModal = document.getElementById('gasto-modal');
            const gastoModalCloseBtn = gastoModal.querySelector('.close-modal');
            const gastoModalTitle = document.getElementById('gasto-modal-title');
            const gastoForm = document.getElementById('gasto-form');
            const gastoIdInput = document.getElementById('gasto-id');
            const gastoNameSelect = document.getElementById('gasto-name-select');
            const gastoAmountInput = document.getElementById('gasto-amount');
            const gastoDateInput = document.getElementById('gasto-date');

            // Referencias a elementos del DOM para Fechas de Pago
            const fechasPagoList = document.getElementById('fechas-pago-list');
            const addPagoBtn = document.getElementById('add-pago-btn');
            const editPagoModeBtn = document.getElementById('edit-pago-mode-btn');
            const deleteSelectedPagosBtn = document.getElementById('delete-selected-pagos-btn');
            const pagoModal = document.getElementById('pago-modal');
            const pagoModalCloseBtn = pagoModal.querySelector('.close-modal');
            const pagoModalTitle = document.getElementById('pago-modal-title');
            const pagoForm = document.getElementById('pago-form');
            const pagoIdInput = document.getElementById('pago-id');
            const pagoDebtNameInput = document.getElementById('pago-debt-name');
            const pagoDateInput = document.getElementById('pago-date-input');

            // Referencias para el modal de confirmación de eliminación
            const confirmDeleteModal = document.getElementById('confirm-delete-modal');
            const closeConfirmDeleteModalBtn = document.getElementById('close-confirm-delete-modal');
            const confirmDeleteMessage = document.getElementById('confirm-delete-message');
            const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
            const confirmDeleteBtn = document.getElementById('confirm-delete-btn');

            let debts = [];
            let gastos = [];
            let pagos = [];
            let currentDebtDates = [];
            let currentDeleteTarget = null; // 'loan', 'cxc', 'debt', 'gasto', 'pago'
            let currentDeleteId = null; // ID for single item deletion
            let isEditModeDebts = false;
            let isEditModeGastos = false;
            let isEditModePagos = false;


            // Datos iniciales de deudas (nombres de la imagen)
            const initialDebtNames = [
                "DIDI PRESTAMO", "MERCADO PAGO", "MELI +", "MAX", "PRIME VIDEO",
                "TALA", "BAUBAP", "RIFA VERO", "RIFA ANDREA", "KUESKI"
            ];

            // Datos iniciales de fechas de pago (de la imagen)
            const initialPagos = [
                { id: 1, debtName: "DIDI PRESTAMO", paymentDate: "CADA QUINCENA" },
                { id: 2, debtName: "MERCADO PAGO", paymentDate: "16 DE CADA MES" },
                { id: 3, debtName: "MELI +", paymentDate: "22 JUNIO 2025" },
                { id: 4, debtName: "MAX", paymentDate: "05-jul-25" },
                { id: 5, debtName: "PRIME VIDEO", paymentDate: "-----" },
                { id: 6, debtName: "TALA", paymentDate: "12-jul-25" },
                { id: 7, debtName: "BAUBAP", paymentDate: "30-jun-25" },
                { id: 8, debtName: "RIFA VERO", paymentDate: "CADA QUINCENA" },
                { id: 9, debtName: "RIFA ANDREA", paymentDate: "-----" },
                { id: 10, debtName: "KUESKI", paymentDate: "04-jul-25" }
            ];

            // --- Funciones Generales de Utilidad ---

            function showConfirmDeleteModal(id, type) {
                currentDeleteTarget = type;
                currentDeleteId = id;
                confirmDeleteMessage.textContent = `¿Estás seguro de que deseas eliminar ${id ? 'este elemento' : 'los elementos seleccionados'} de ${type === 'loan' ? 'préstamos' : type === 'cxc' ? 'cuentas por cobrar' : type === 'debt' ? 'deudas' : type === 'gasto' ? 'gastos personales' : 'fechas de pago'}?`;
                confirmDeleteModal.classList.add('active');
            }

            function closeConfirmDeleteModal() {
                confirmDeleteModal.classList.remove('active');
                currentDeleteTarget = null;
                currentDeleteId = null;
            }

            confirmDeleteBtn.addEventListener('click', () => {
                if (currentDeleteTarget === 'loan') {
                    loans = loans.filter(loan => loan.id !== currentDeleteId);
                    saveLoans();
                    renderLoans();
                    showNotification('Préstamo eliminado con éxito', 'success');
                } else if (currentDeleteTarget === 'cxc') {
                    cxcs = cxcs.filter(cxc => cxc.id !== currentDeleteId);
                    saveCxCs();
                    renderCxCs();
                    showNotification('Cuenta eliminada con éxito', 'success');
                } else if (currentDeleteTarget === 'debt') {
                    deleteSelectedDebts();
                } else if (currentDeleteTarget === 'gasto') {
                    deleteSelectedGastos();
                } else if (currentDeleteTarget === 'pago') {
                    deleteSelectedPagos();
                }
                closeConfirmDeleteModal();
            });

            cancelDeleteBtn.addEventListener('click', () => {
                closeConfirmDeleteModal();
            });

            closeConfirmDeleteModalBtn.addEventListener('click', () => {
                closeConfirmDeleteModal();
            });

            confirmDeleteModal.addEventListener('click', (e) => {
                if (e.target === confirmDeleteModal) {
                    closeConfirmDeleteModal();
                }
            });


            // --- Lógica para Deudas ---

            function getFridaysInPeriod(startDate, endDate) {
                const dates = [];
                let currentDate = new Date(startDate);
                currentDate.setDate(currentDate.getDate() + (5 + 7 - currentDate.getDay()) % 7); // Go to first Friday

                while (currentDate <= endDate) {
                    dates.push(new Date(currentDate));
                    currentDate.setDate(currentDate.getDate() + 7); // Add 7 days for next Friday
                }
                return dates;
            }

            function formatToYYYYMMDD(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            function formatToDDMonYY(date) {
                const options = { day: '2-digit', month: 'short', year: '2-digit' };
                return date.toLocaleDateString('es-ES', options).replace(/\./g, '').replace(' ', '-');
            }

            function loadDebts() {
                try {
                    const savedDebts = localStorage.getItem('deudas');
                    // If there are saved debts, parse them. Otherwise, use initial debt names and initialize amounts.
                    debts = savedDebts ? JSON.parse(savedDebts) : initialDebtNames.map(name => ({
                        id: Date.now() + Math.random(),
                        name: name,
                        amounts: {} // Amounts will be keyed by date (YYYY-MM-DD)
                    }));
                    console.log("Deudas cargadas:", debts); // Debug log
                } catch (e) {
                    console.error("Error al cargar deudas de localStorage", e);
                    // Fallback to initial data if loading fails
                    debts = initialDebtNames.map(name => ({
                        id: Date.now() + Math.random(),
                        name: name,
                        amounts: {}
                    }));
                }
            }

            function saveDebts() {
                try {
                    localStorage.setItem('deudas', JSON.stringify(debts));
                    console.log("Deudas guardadas:", debts); // Debug log
                } catch (e) {
                    console.error("Error al guardar deudas en localStorage", e);
                }
            }

            function calculateTotalDebts() {
                const totalByDate = {};
                currentDebtDates.forEach(date => {
                    const dateKey = formatToYYYYMMDD(date);
                    totalByDate[dateKey] = 0;
                });

                debts.forEach(debt => {
                    currentDebtDates.forEach(date => {
                        const dateKey = formatToYYYYMMDD(date);
                        // Always read from the 'amounts' object in the debt array,
                        // as the input listener ensures this is up-to-date.
                        const amount = debt.amounts[dateKey] || 0;
                        totalByDate[dateKey] += amount;
                    });
                });

                // Clear existing tfoot content
                debtsTotalRow.innerHTML = ''; 
                
                // Create the new total row structure
                const totalRowContent = document.createElement('tr');
                totalRowContent.classList.add('total-row'); // Add class for styling
                
                totalRowContent.innerHTML = `<td><strong>Total</strong></td>`; // First cell for "Total" label
                
                currentDebtDates.forEach(date => {
                    const dateKey = formatToYYYYMMDD(date);
                    totalRowContent.innerHTML += `<td><strong>$${totalByDate[dateKey].toFixed(2)}</strong></td>`; // Add cells for each date total
                });
                
                debtsTotalRow.appendChild(totalRowContent); // Append the new row to tfoot

                // Update the overall total debts display
                const overallTotal = Object.values(totalByDate).reduce((sum, val) => sum + val, 0);
                totalDeudasDisplay.textContent = `$${overallTotal.toFixed(2)}`;
            }

            function renderDebts() {
                debtDatesRow.innerHTML = '<th>Deuda</th>';
                currentDebtDates.forEach(date => {
                    debtDatesRow.innerHTML += `<th>${formatToDDMonYY(date)}</th>`;
                });
                if (isEditModeDebts) {
                    debtDatesRow.innerHTML += '<th>Eliminar</th>'; // Add delete column in edit mode
                }

                debtsList.innerHTML = '';
                if (debts.length === 0) {
                    debtsList.innerHTML = `<tr><td colspan="${currentDebtDates.length + (isEditModeDebts ? 2 : 1)}" style="text-align: center; padding: 30px;">No hay deudas registradas</td></tr>`;
                    calculateTotalDebts();
                    return;
                }

                debts.forEach(debt => {
                    const row = document.createElement('tr');
                    row.dataset.id = debt.id;
                    let rowContent = `<td>${debt.name}</td>`;
                    currentDebtDates.forEach(date => {
                        const dateKey = formatToYYYYMMDD(date);
                        const amount = debt.amounts[dateKey] || 0;
                        if (isEditModeDebts) {
                            rowContent += `<td><input type="number" class="form-control amount-input" data-date="${dateKey}" value="${amount.toFixed(2)}" step="0.01"></td>`;
                        } else {
                            rowContent += `<td>$${amount.toFixed(2)}</td>`;
                        }
                    });
                    if (isEditModeDebts) {
                        rowContent += `<td><input type="checkbox" class="debt-checkbox" data-id="${debt.id}"></td>`;
                    }
                    row.innerHTML = rowContent;
                    debtsList.appendChild(row);
                });
                calculateTotalDebts(); // Calculate totals after rendering rows

                // Add input event listeners if in edit mode
                if (isEditModeDebts) {
                    debtsList.querySelectorAll('.amount-input').forEach(input => {
                        input.addEventListener('input', function() {
                            const debtId = parseInt(this.closest('tr').dataset.id);
                            const dateKey = this.dataset.date;
                            const newAmount = parseFloat(this.value) || 0;
                            
                            const debtIndex = debts.findIndex(d => d.id === debtId);
                            if (debtIndex !== -1) {
                                debts[debtIndex].amounts[dateKey] = newAmount;
                            }
                            calculateTotalDebts(); // Recalculate totals on input change
                        });
                    });
                }
            }

            function openDebtModal(debtId = null) {
                currentEditId = debtId;
                debtAmountsGroup.innerHTML = ''; // Clear previous amount inputs

                if (debtId) {
                    debtModalTitle.textContent = 'Editar Deuda';
                    const debt = debts.find(d => d.id === debtId);
                    if (debt) {
                        debtIdInput.value = debt.id;
                        debtNameInput.value = debt.name;
                        currentDebtDates.forEach(date => {
                            const dateKey = formatToYYYYMMDD(date);
                            const amount = debt.amounts[dateKey] || 0;
                            debtAmountsGroup.innerHTML += `
                                <div class="form-group">
                                    <label for="amount-${dateKey}">${formatToDDMonYY(date)} ($)</label>
                                    <input type="number" id="amount-${dateKey}" class="form-control debt-amount-input" data-date="${dateKey}" value="${amount.toFixed(2)}" step="0.01">
                                </div>
                            `;
                        });
                    }
                } else {
                    debtModalTitle.textContent = 'Añadir Nueva Deuda';
                    debtForm.reset();
                    debtIdInput.value = '';
                    currentDebtDates.forEach(date => {
                        const dateKey = formatToYYYYMMDD(date);
                        debtAmountsGroup.innerHTML += `
                            <div class="form-group">
                                <label for="amount-${dateKey}">${formatToDDMonYY(date)} ($)</label>
                                <input type="number" id="amount-${dateKey}" class="form-control debt-amount-input" data-date="${dateKey}" value="0.00" step="0.01">
                            </div>
                        `;
                    });
                }
                debtModal.classList.add('active');
            }

            function closeDebtModal() {
                debtModal.classList.remove('active');
                currentEditId = null;
            }

            function handleDebtFormSubmit(e) {
                e.preventDefault();
                const debtName = debtNameInput.value.trim();
                if (debtName === '') {
                    showNotification('El nombre de la deuda no puede estar vacío', 'error');
                    return;
                }

                const amounts = {};
                document.querySelectorAll('.debt-amount-input').forEach(input => {
                    const dateKey = input.dataset.date;
                    amounts[dateKey] = parseFloat(input.value) || 0;
                });

                if (currentEditId) {
                    const debtIndex = debts.findIndex(d => d.id === currentEditId);
                    if (debtIndex !== -1) {
                        debts[debtIndex].name = debtName;
                        debts[debtIndex].amounts = amounts;
                        showNotification('Deuda actualizada con éxito', 'success');
                    }
                } else {
                    const newDebt = { id: Date.now(), name: debtName, amounts: amounts };
                    debts.push(newDebt);
                    showNotification('Deuda añadida con éxito', 'success');
                }
                saveDebts(); // Save to localStorage after adding/updating
                renderDebts();
                closeDebtModal();
            }

            function toggleEditModeDebts() {
                isEditModeDebts = !isEditModeDebts;
                if (isEditModeDebts) {
                    editDebtModeBtn.textContent = 'Guardar Cambios';
                    editDebtModeBtn.classList.add('active'); // Visual feedback for active edit mode
                    addDebtBtn.style.display = 'none'; // Hide add button in edit mode
                    deleteSelectedDebtsBtn.style.display = 'inline-flex'; // Show delete button
                } else {
                    // When exiting edit mode, explicitly save all current input values
                    debtsList.querySelectorAll('tr').forEach(rowElement => {
                        const debtId = parseInt(rowElement.dataset.id);
                        const debt = debts.find(d => d.id === debtId);
                        if (debt) {
                            rowElement.querySelectorAll('.amount-input').forEach(inputElement => {
                                const dateKey = inputElement.dataset.date;
                                debt.amounts[dateKey] = parseFloat(inputElement.value) || 0;
                            });
                        }
                    });
                    saveDebts(); // Save the updated debts array
                    editDebtModeBtn.textContent = 'Editar Deudas';
                    editDebtModeBtn.classList.remove('active');
                    addDebtBtn.style.display = 'inline-flex';
                    deleteSelectedDebtsBtn.style.display = 'none';
                    showNotification('Cambios en deudas guardados', 'success');
                }
                renderDebts(); // Re-render table to reflect edit mode (either with inputs or display values)
            }

            function deleteSelectedDebts() {
                const selectedDebtIds = Array.from(document.querySelectorAll('.debt-checkbox:checked'))
                                            .map(checkbox => parseInt(checkbox.dataset.id));
                if (selectedDebtIds.length > 0) {
                    debts = debts.filter(debt => !selectedDebtIds.includes(debt.id));
                    saveDebts(); // Save to localStorage after deletion
                    renderDebts();
                    showNotification('Deudas seleccionadas eliminadas', 'success');
                } else {
                    showNotification('Ninguna deuda seleccionada para eliminar', 'info');
                }
                closeConfirmDeleteModal();
            }

            // Event Listeners para Deudas
            generateDebtDatesBtn.addEventListener('click', () => {
                const startDate = new Date(startDateDebtsInput.value);
                const endDate = new Date(endDateDebtsInput.value);

                if (isNaN(startDate) || isNaN(endDate) || startDate > endDate) {
                    showNotification('Por favor, selecciona un rango de fechas válido.', 'error');
                    return;
                }

                const today = new Date(); // Define today here for consistency
                const threeMonthsLater = new Date();
                threeMonthsLater.setMonth(today.getMonth() + 3); 

                if (endDate > threeMonthsLater) {
                    showNotification('El período no puede exceder 3 meses a partir de la fecha actual.', 'error');
                    return;
                }

                currentDebtDates = getFridaysInPeriod(startDate, endDate);
                renderDebts();
            });

            addDebtBtn.addEventListener('click', () => openDebtModal());
            debtModalCloseBtn.addEventListener('click', () => closeDebtModal());
            debtForm.addEventListener('submit', handleDebtFormSubmit);
            debtModal.addEventListener('click', (e) => { if (e.target === debtModal) closeDebtModal(); });
            editDebtModeBtn.addEventListener('click', toggleEditModeDebts);
            deleteSelectedDebtsBtn.addEventListener('click', () => {
                const selectedCount = document.querySelectorAll('.debt-checkbox:checked').length;
                if (selectedCount > 0) {
                    showConfirmDeleteModal(null, 'debt'); // Pass null for ID to indicate multiple deletion
                } else {
                    showNotification('Ninguna deuda seleccionada para eliminar', 'info');
                }
            });

            // Set default dates for Debt section (current date to 3 months from now)
            const today = new Date();
            const threeMonthsFromNow = new Date();
            threeMonthsFromNow.setMonth(today.getMonth() + 3);
            startDateDebtsInput.value = formatToYYYYMMDD(today);
            endDateDebtsInput.value = formatToYYYYMMDD(threeMonthsFromNow);
            // Automatically generate dates on load
            currentDebtDates = getFridaysInPeriod(new Date(startDateDebtsInput.value), new Date(endDateDebtsInput.value));
            loadDebts(); // Load debts from localStorage first
            renderDebts();


            // --- Lógica para Gastos Personales ---

            function loadGastos() {
                try {
                    const savedGastos = localStorage.getItem('gastosPersonales');
                    gastos = savedGastos ? JSON.parse(savedGastos) : [];
                    console.log("Gastos cargados:", gastos); // Debug log
                } catch (e) {
                    console.error("Error al cargar gastos de localStorage", e);
                    gastos = [];
                }
            }

            function saveGastos() {
                try {
                    localStorage.setItem('gastosPersonales', JSON.stringify(gastos));
                    console.log("Gastos guardados:", gastos); // Debug log
                } catch (e) {
                    console.error("Error al guardar gastos en localStorage", e);
                }
            }

            function calculateTotalGastos() {
                const total = gastos.reduce((sum, gasto) => sum + parseFloat(gasto.amount), 0);
                totalGastosDisplay.textContent = `$${total.toFixed(2)}`;
            }

            function renderGastos() {
                gastosList.innerHTML = '';
                if (gastos.length === 0) {
                    gastosList.innerHTML = `<tr><td colspan="4" style="text-align: center; padding: 30px;">No hay gastos registrados</td></tr>`;
                    calculateTotalGastos();
                    return;
                }
                gastos.forEach(gasto => {
                    const row = document.createElement('tr');
                    row.dataset.id = gasto.id;
                    let rowContent = `
                        <td>${gasto.name}</td>
                        <td class="loan-amount">$${parseFloat(gasto.amount).toFixed(2)}</td>
                        <td>${gasto.date}</td>
                    `;
                    if (isEditModeGastos) {
                        rowContent = `
                            <td><input type="text" class="form-control" value="${gasto.name}" data-field="name"></td>
                            <td><input type="number" class="form-control amount-input" value="${parseFloat(gasto.amount).toFixed(2)}" step="0.01" data-field="amount"></td>
                            <td><input type="date" class="form-control" value="${gasto.date}" data-field="date"></td>
                            <td><input type="checkbox" class="gasto-checkbox" data-id="${gasto.id}"></td>
                        `;
                    } else {
                        rowContent += `
                            <td class="loan-actions">
                                <button class="action-btn edit-btn" data-id="${gasto.id}"><i class="fas fa-edit"></i></button>
                                <button class="action-btn delete-btn" data-id="${gasto.id}"><i class="fas fa-trash-alt"></i></button>
                            </td>
                        `;
                    }
                    row.innerHTML = rowContent;
                    gastosList.appendChild(row);
                });
                calculateTotalGastos();
                if (!isEditModeGastos) {
                    addGastoRowEventListeners();
                }
            }

            function addGastoRowEventListeners() {
                gastosList.querySelectorAll('.edit-btn').forEach(button => {
                    button.onclick = () => openGastoModal(parseInt(button.dataset.id));
                });
                gastosList.querySelectorAll('.delete-btn').forEach(button => {
                    button.onclick = () => showConfirmDeleteModal(parseInt(button.dataset.id), 'gasto');
                });
            }

            function openGastoModal(gastoId = null) {
                currentEditId = gastoId;
                if (gastoId) {
                    gastoModalTitle.textContent = 'Editar Gasto';
                    const gasto = gastos.find(g => g.id === gastoId);
                    if (gasto) {
                        gastoIdInput.value = gasto.id;
                        gastoNameSelect.value = gasto.name;
                        gastoAmountInput.value = gasto.amount;
                        gastoDateInput.value = gasto.date;
                    }
                } else {
                    gastoModalTitle.textContent = 'Añadir Nuevo Gasto';
                    gastoForm.reset();
                    gastoIdInput.value = '';
                    gastoDateInput.value = formatToYYYYMMDD(new Date()); // Default to today
                }
                gastoModal.classList.add('active');
            }

            function closeGastoModal() {
                gastoModal.classList.remove('active');
                currentEditId = null;
            }

            function handleGastoFormSubmit(e) {
                e.preventDefault();
                const name = gastoNameSelect.value.trim();
                const amount = parseFloat(gastoAmountInput.value);
                const date = gastoDateInput.value;

                if (name === '' || isNaN(amount) || amount <= 0 || date === '') {
                    showNotification('Por favor completa todos los campos de gasto correctamente', 'error');
                    return;
                }

                if (currentEditId) {
                    const gastoIndex = gastos.findIndex(g => g.id === currentEditId);
                    if (gastoIndex !== -1) {
                        gastos[gastoIndex].name = name;
                        gastos[gastoIndex].amount = amount;
                        gastos[gastoIndex].date = date;
                        showNotification('Gasto actualizado con éxito', 'success');
                    }
                } else {
                    const newGasto = { id: Date.now(), name: name, amount: amount, date: date };
                    gastos.push(newGasto);
                    showNotification('Gasto añadido con éxito', 'success');
                }
                saveGastos();
                renderGastos();
                closeGastoModal();
            }

            function toggleEditModeGastos() {
                isEditModeGastos = !isEditModeGastos;
                if (isEditModeGastos) {
                    editGastoModeBtn.textContent = 'Guardar Cambios';
                    editGastoModeBtn.classList.add('active');
                    addGastoBtn.style.display = 'none';
                    deleteSelectedGastosBtn.style.display = 'inline-flex';
                } else {
                    editGastoModeBtn.textContent = 'Editar Gastos';
                    editGastoModeBtn.classList.remove('active');
                    addGastoBtn.style.display = 'inline-flex';
                    deleteSelectedGastosBtn.style.display = 'none';
                    // Save changes from inline edits
                    gastosList.querySelectorAll('tr').forEach(row => {
                        const gastoId = parseInt(row.dataset.id);
                        const gastoIndex = gastos.findIndex(g => g.id === gastoId);
                        if (gastoIndex !== -1) {
                            gastos[gastoIndex].name = row.querySelector('[data-field="name"]').value;
                            gastos[gastoIndex].amount = parseFloat(row.querySelector('[data-field="amount"]').value) || 0;
                            gastos[gastoIndex].date = row.querySelector('[data-field="date"]').value;
                        }
                    });
                    saveGastos();
                    showNotification('Cambios en gastos guardados', 'success');
                }
                renderGastos();
            }

            function deleteSelectedGastos() {
                const selectedGastoIds = Array.from(document.querySelectorAll('.gasto-checkbox:checked'))
                                            .map(checkbox => parseInt(checkbox.dataset.id));
                if (selectedGastoIds.length > 0) {
                    gastos = gastos.filter(gasto => !selectedGastoIds.includes(gasto.id));
                    saveGastos();
                    renderGastos();
                    showNotification('Gastos seleccionados eliminados', 'success');
                } else {
                    showNotification('Ningún gasto seleccionado para eliminar', 'info');
                }
                closeConfirmDeleteModal();
            }

            // Event Listeners para Gastos Personales
            addGastoBtn.addEventListener('click', () => openGastoModal());
            gastoModalCloseBtn.addEventListener('click', () => closeGastoModal());
            gastoForm.addEventListener('submit', handleGastoFormSubmit);
            gastoModal.addEventListener('click', (e) => { if (e.target === gastoModal) closeGastoModal(); });
            editGastoModeBtn.addEventListener('click', toggleEditModeGastos);
            deleteSelectedGastosBtn.addEventListener('click', () => {
                const selectedCount = document.querySelectorAll('.gasto-checkbox:checked').length;
                if (selectedCount > 0) {
                    showConfirmDeleteModal(null, 'gasto');
                } else {
                    showNotification('Ningún gasto seleccionado para eliminar', 'info');
                }
            });

            loadGastos();
            renderGastos();

            // --- Lógica para Fechas de Pago ---

            function loadPagos() {
                try {
                    const savedPagos = localStorage.getItem('fechasDePago');
                    pagos = savedPagos ? JSON.parse(savedPagos) : initialPagos;
                    console.log("Fechas de pago cargadas:", pagos); // Debug log
                } catch (e) {
                    console.error("Error al cargar fechas de pago de localStorage", e);
                    pagos = initialPagos;
                }
            }

            function savePagos() {
                try {
                    localStorage.setItem('fechasDePago', JSON.stringify(pagos));
                    console.log("Fechas de pago guardadas:", pagos); // Debug log
                } catch (e) {
                    console.error("Error al guardar fechas de pago en localStorage", e);
                }
            }

            function renderPagos() {
                fechasPagoList.innerHTML = '';
                if (pagos.length === 0) {
                    fechasPagoList.innerHTML = `<tr><td colspan="3" style="text-align: center; padding: 30px;">No hay fechas de pago registradas</td></tr>`;
                    return;
                }
                pagos.forEach(pago => {
                    const row = document.createElement('tr');
                    row.dataset.id = pago.id;
                    let rowContent = `
                        <td>${pago.debtName}</td>
                        <td>${pago.paymentDate}</td>
                    `;
                    if (isEditModePagos) {
                        rowContent = `
                            <td><input type="text" class="form-control" value="${pago.debtName}" data-field="debtName"></td>
                            <td><input type="text" class="form-control" value="${pago.paymentDate}" data-field="paymentDate"></td>
                            <td><input type="checkbox" class="pago-checkbox" data-id="${pago.id}"></td>
                        `;
                    } else {
                        rowContent += `
                            <td class="loan-actions">
                                <button class="action-btn edit-btn" data-id="${pago.id}"><i class="fas fa-edit"></i></button>
                                <button class="action-btn delete-btn" data-id="${pago.id}"><i class="fas fa-trash-alt"></i></button>
                            </td>
                        `;
                    }
                    row.innerHTML = rowContent;
                    fechasPagoList.appendChild(row);
                });
                if (!isEditModePagos) {
                    addPagoRowEventListeners();
                }
            }

            function addPagoRowEventListeners() {
                fechasPagoList.querySelectorAll('.edit-btn').forEach(button => {
                    button.onclick = () => openPagoModal(parseInt(button.dataset.id));
                });
                fechasPagoList.querySelectorAll('.delete-btn').forEach(button => {
                    button.onclick = () => showConfirmDeleteModal(parseInt(button.dataset.id), 'pago');
                });
            }

            function openPagoModal(pagoId = null) {
                currentEditId = pagoId;
                if (pagoId) {
                    pagoModalTitle.textContent = 'Editar Fecha de Pago';
                    const pago = pagos.find(p => p.id === pagoId);
                    if (pago) {
                        pagoIdInput.value = pago.id;
                        pagoDebtNameInput.value = pago.debtName;
                        pagoDateInput.value = pago.paymentDate;
                    }
                } else {
                    pagoModalTitle.textContent = 'Añadir Nueva Fecha de Pago';
                    pagoForm.reset();
                    pagoIdInput.value = '';
                }
                pagoModal.classList.add('active');
            }

            function closePagoModal() {
                pagoModal.classList.remove('active');
                currentEditId = null;
            }

            function handlePagoFormSubmit(e) {
                e.preventDefault();
                const debtName = pagoDebtNameInput.value.trim();
                const paymentDate = pagoDateInput.value.trim();

                if (debtName === '' || paymentDate === '') {
                    showNotification('Por favor completa todos los campos de pago correctamente', 'error');
                    return;
                }

                if (currentEditId) {
                    const pagoIndex = pagos.findIndex(p => p.id === currentEditId);
                    if (pagoIndex !== -1) {
                        pagos[pagoIndex].debtName = debtName;
                        pagos[pagoIndex].paymentDate = paymentDate;
                        showNotification('Fecha de pago actualizada con éxito', 'success');
                    }
                } else {
                    const newPago = { id: Date.now(), debtName: debtName, paymentDate: paymentDate };
                    pagos.push(newPago);
                    showNotification('Fecha de pago añadida con éxito', 'success');
                }
                savePagos();
                renderPagos();
                closePagoModal();
            }

            function toggleEditModePagos() {
                isEditModePagos = !isEditModePagos;
                if (isEditModePagos) {
                    editPagoModeBtn.textContent = 'Guardar Cambios';
                    editPagoModeBtn.classList.add('active');
                    addPagoBtn.style.display = 'none';
                    deleteSelectedPagosBtn.style.display = 'inline-flex';
                } else {
                    editPagoModeBtn.textContent = 'Editar Pagos';
                    editPagoModeBtn.classList.remove('active');
                    addPagoBtn.style.display = 'inline-flex';
                    deleteSelectedPagosBtn.style.display = 'none';
                    // Save changes from inline edits
                    fechasPagoList.querySelectorAll('tr').forEach(row => {
                        const pagoId = parseInt(row.dataset.id);
                        const pagoIndex = pagos.findIndex(p => p.id === pagoId);
                        if (pagoIndex !== -1) {
                            pagos[pagoIndex].debtName = row.querySelector('[data-field="debtName"]').value;
                            pagos[pagoIndex].paymentDate = row.querySelector('[data-field="paymentDate"]').value;
                        }
                    });
                    savePagos();
                    showNotification('Cambios en fechas de pago guardados', 'success');
                }
                renderPagos();
            }

            function deleteSelectedPagos() {
                const selectedPagoIds = Array.from(document.querySelectorAll('.pago-checkbox:checked'))
                                            .map(checkbox => parseInt(checkbox.dataset.id));
                if (selectedPagoIds.length > 0) {
                    pagos = pagos.filter(pago => !selectedPagoIds.includes(pago.id));
                    savePagos();
                    renderPagos();
                    showNotification('Fechas de pago seleccionadas eliminadas', 'success');
                } else {
                    showNotification('Ninguna fecha de pago seleccionada para eliminar', 'info');
                }
                closeConfirmDeleteModal();
            }

            // Event Listeners para Fechas de Pago
            addPagoBtn.addEventListener('click', () => openPagoModal());
            pagoModalCloseBtn.addEventListener('click', () => closePagoModal());
            pagoForm.addEventListener('submit', handlePagoFormSubmit);
            pagoModal.addEventListener('click', (e) => { if (e.target === pagoModal) closePagoModal(); });
            editPagoModeBtn.addEventListener('click', toggleEditModePagos);
            deleteSelectedPagosBtn.addEventListener('click', () => {
                const selectedCount = document.querySelectorAll('.pago-checkbox:checked').length;
                if (selectedCount > 0) {
                    showConfirmDeleteModal(null, 'pago');
                } else {
                    showNotification('Ninguna fecha de pago seleccionada para eliminar', 'info');
                }
            });

            loadPagos();
            renderPagos();

            // --- Lógica para el selector de categorías de Finanzas ---
            const financeCategoryBtns = document.querySelectorAll('.finance-category-btn');
            const financeSectionContents = document.querySelectorAll('.finance-section-content');

            function activateFinanceCategory(category) {
                financeCategoryBtns.forEach(btn => {
                    if (btn.dataset.financeCategory === category) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });

                financeSectionContents.forEach(content => {
                    if (content.classList.contains(`${category}-content`)) {
                        content.style.display = 'block';
                    } else {
                        content.style.display = 'none';
                    }
                });
            }

            financeCategoryBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    activateFinanceCategory(this.dataset.financeCategory);
                });
            });

            // Activar la primera categoría de finanzas por defecto al cargar
            activateFinanceCategory('debts');

        });
    </script>
</body>
</html>
